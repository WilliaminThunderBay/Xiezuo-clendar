# 测试指南：AI助手创建日程功能

## 快速测试步骤

### 方法1：使用测试页面（推荐）

1. **打开测试页面**
   ```
   http://localhost:3000/test_ai_schedule.html
   ```

2. **按照页面提示操作**
   - 点击"检查环境" - 确认环境正常
   - 点击"初始化数据" - 加载测试数据
   - 点击"测试创建工单" - 验证创建功能
   - 点击"打开AI助手" - 打开AI对话窗口

3. **在AI助手中测试**
   输入以下任意一条：
   ```
   创建明天上午9点到12点的安装工单，地点浦东张江，车牌沪A12345，安装人员李明
   
   明天下午2点到5点，张三，徐汇中山路，沪B88888，量尺
   
   后天上午，王五在闵行莘庄安装，车牌沪A99999
   ```

4. **查看结果**
   - AI助手显示成功消息
   - 测试页面自动刷新任务列表
   - 新工单出现在列表中

---

### 方法2：使用实际日历页面

1. **打开主日历**
   ```
   http://localhost:3000/installation_schedule.html
   ```
   或
   ```
   http://localhost:3000/frontend/installation_schedule.html
   ```

2. **点击AI助手按钮**
   页面右下角的"🤖 AI智能助手"按钮

3. **在AI助手中输入创建指令**
   ```
   创建明天上午9点到12点的安装工单，地点浦东张江，车牌沪A12345，安装人员李明
   ```

4. **验证结果**
   - ✅ AI助手显示"✅ 工单创建成功！"
   - ✅ 主日历页面自动刷新
   - ✅ 新工单显示在日历中
   - ✅ 右侧活动日志显示操作记录

---

## 支持的创建格式

### 完整格式
```
创建[日期][时间][服务类型]工单，地点[位置]，车牌[车牌号]，安装人员[姓名]
```

### 示例

**标准格式：**
```
创建明天上午9点到12点的安装工单，地点浦东张江，车牌沪A12345，安装人员李明
```

**简化格式：**
```
明天9点 李明 浦东张江 沪A12345 安装
```

**自然语言：**
```
帮我安排李明明天上午去浦东张江安装，车牌是沪A12345
```

**批量信息：**
```
明天9-12点，李明，浦东张江，沪A12345，安装
后天14-17点，张三，徐汇中山，沪B88888，量尺
```

---

## 可识别的信息

### 日期关键词
- `今天` / `今日`
- `明天` / `明日`  
- `后天`
- `YYYY-MM-DD` 格式（如 2024-11-20）

### 时间格式
- `9点到12点`
- `09:00-12:00`
- `上午9点`
- `下午2点到5点`

### 服务类型
- `安装`
- `量尺`
- `维修`
- `售后`

### 车牌格式
- `沪A12345`
- `沪A·12345`
- `京B88888`
- 其他省份车牌

### 地点格式
- 区域：`浦东`、`徐汇`、`静安`等
- 街道：`张江`、`中山路`、`南京路`等
- 完整地址：`浦东张江高科技园`

---

## 调试信息

### 浏览器控制台

**打开方式：** F12 或 右键 → 检查

**成功创建时的日志：**
```
===== 开始创建日程 =====
接收到的数据: {date: "2024-11-17", staff: "李明", ...}
父窗口对象: Window {...}
父窗口tasks存在?: true
✅ 通过addTaskFromAI函数创建成功
收到AI助手创建任务请求: {...}
任务创建成功: {id: 3, number: "W003", ...}
✅ 工单创建完成
===== 创建流程结束 =====
```

### 常见错误及解决

**错误1：`❌ 无法连接到主窗口`**
- **原因：** AI助手不是从日历页面打开的
- **解决：** 在日历页面点击AI助手按钮打开

**错误2：`❌ 缺少必填信息：安装人员、地点`**
- **原因：** 输入信息不完整
- **解决：** 补充缺失的信息后重新输入

**错误3：`⚠️ addTaskFromAI函数不存在`**
- **原因：** 主页面未更新
- **解决：** 刷新主日历页面后重试（或使用回退方案）

**错误4：`任务创建成功但日历未刷新`**
- **原因：** renderCalendar函数未执行
- **解决：** 手动刷新页面查看

---

## 预期结果

### AI助手窗口
显示成功消息：
```
✅ 工单创建成功！

📋 工单信息：
• 工单号：W003
• 日期：2024-11-17
• 时间：09:00-12:00
• 地点：浦东张江
• 车牌：沪A12345
• 员工：李明
• 服务：安装

请在主日历页面查看该工单。
```

### 主日历页面
- 日历视图自动刷新
- 新工单出现在对应日期
- 工单颜色和标签正确
- 活动日志显示"AI助手 创建了 W003"
- Toast提示"✅ 已创建工单 W003"

### 浏览器控制台
无错误信息，只有成功日志

---

## 故障排除

### 问题：AI助手无法打开
**检查：**
1. 浏览器是否阻止弹窗？
2. 文件路径是否正确？
3. 是否从正确的页面打开？

**解决：**
- 允许浏览器弹窗
- 检查控制台错误信息
- 确认从 `installation_schedule.html` 打开

### 问题：创建后没有反应
**检查：**
1. 打开控制台查看错误
2. 确认 `window.tasks` 是否存在
3. 确认 `window.addTaskFromAI` 是否存在

**解决：**
1. 刷新主日历页面
2. 确认文件已更新
3. 清除浏览器缓存

### 问题：信息识别不准确
**检查：**
1. 输入格式是否标准
2. 必填信息是否完整

**解决：**
1. 使用标准格式重新输入
2. 补充缺失信息
3. 参考上方的示例格式

---

## 技术验证清单

使用测试页面验证以下功能：

- [ ] `window.tasks` 变量可访问
- [ ] `window.addTaskFromAI` 函数存在
- [ ] localStorage 正常工作
- [ ] AI助手窗口可正常打开
- [ ] 子窗口可访问父窗口变量
- [ ] 创建功能正常工作
- [ ] 任务列表自动刷新
- [ ] 控制台无错误信息

---

## 性能测试

### 批量创建测试
1. 连续创建10个工单
2. 检查响应时间
3. 验证数据一致性

### 并发测试
1. 打开多个AI助手窗口
2. 同时创建工单
3. 检查数据冲突

### 边界测试
1. 创建100+工单后的性能
2. 极长文本输入
3. 特殊字符处理

---

## 联系支持

如果遇到问题：
1. 查看 `AI助手创建日程功能修复说明.md`
2. 检查浏览器控制台日志
3. 确认文件版本是否最新
4. 提供详细错误信息

---

## 更新记录

**2024-11-16**
- ✅ 修复 `tasks` 变量作用域问题
- ✅ 添加 `window.addTaskFromAI` 桥接函数
- ✅ 优化 AI助手创建逻辑
- ✅ 添加详细调试日志
- ✅ 创建测试页面

**功能状态：** ✅ 正常工作
