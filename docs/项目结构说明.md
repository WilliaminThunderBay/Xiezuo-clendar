# é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸ“‚ ç›®å½•ç»“æ„

```
xiezuoCalendar/
â”œâ”€â”€ ğŸ“ frontend/              å‰ç«¯é™æ€æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ installation_schedule.html    ä¸»æ—¥å†ç³»ç»Ÿï¼ˆ3200+è¡Œæ ¸å¿ƒåº”ç”¨ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ login.html                    ç”¨æˆ·ç™»å½•é¡µé¢
â”‚   â”œâ”€â”€ ğŸ“„ notification-center.html      é€šçŸ¥ä¸­å¿ƒç•Œé¢
â”‚   â”œâ”€â”€ ğŸ“„ reports.html                  æ•°æ®æŠ¥è¡¨ç»Ÿè®¡é¡µé¢
â”‚   â”œâ”€â”€ ğŸ“„ ai_assistant.html             AIåŠ©æ‰‹ï¼ˆåŸå§‹ç‰ˆæœ¬ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ ai_assistant_v4.html          AIåŠ©æ‰‹ v4å¢å¼ºç‰ˆ
â”‚   â”œâ”€â”€ ğŸ“„ ai_assistant_float.html       AIåŠ©æ‰‹æ‚¬æµ®çª—ç‰ˆï¼ˆé¡¹ç›®ç®¡ç†ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ ai_diagnostic.html            AIè¯Šæ–­å·¥å…·
â”‚   â”œâ”€â”€ ğŸ“„ wechat_callback.html          å¾®ä¿¡OAuthå›è°ƒé¡µé¢
â”‚   â””â”€â”€ ğŸ“„ app-config.js                 å‰ç«¯å…¨å±€é…ç½®æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“ backend/               åç«¯æœåŠ¡ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“ src/              æºä»£ç ç›®å½•
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ index.js              Expressåº”ç”¨ä¸»å…¥å£
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ config.js             åç«¯é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ db.js                 JSONæ•°æ®åº“æ“ä½œå°è£…
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ scheduler.js          å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆé€šçŸ¥æé†’ï¼‰
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ middleware/    ä¸­é—´ä»¶ç›®å½•
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ auth.js           JWTè®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ routes/        è·¯ç”±æ¨¡å—ç›®å½•
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ authRoutes.js         ç”¨æˆ·è®¤è¯è·¯ç”±ï¼ˆæ³¨å†Œ/ç™»å½•ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ taskRoutes.js         å·¥å•ç®¡ç†è·¯ç”±ï¼ˆCRUD+æ‹–æ‹½ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ staffRoutes.js        å‘˜å·¥ç®¡ç†è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ serviceRoutes.js      æœåŠ¡ç±»å‹è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ activityRoutes.js     æ´»åŠ¨æ—¥å¿—è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ aiRoutes.js           AIåŠ©æ‰‹è·¯ç”±ï¼ˆDeepSeeké›†æˆï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ wechatRoutes.js       å¾®ä¿¡ç™»å½•é›†æˆè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ fileRoutes.js         æ–‡ä»¶ä¸Šä¼ ç®¡ç†è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ onlineRoutes.js       åœ¨çº¿ç”¨æˆ·ç®¡ç†è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ reportRoutes.js       æŠ¥è¡¨ç»Ÿè®¡è·¯ç”±ï¼ˆ7ä¸ªç«¯ç‚¹ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ notificationRoutes.js é€šçŸ¥ç³»ç»Ÿè·¯ç”±
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ utils/         å·¥å…·å‡½æ•°ç›®å½•
â”‚   â”‚       â””â”€â”€ ğŸ“„ auth.js           JWTç”Ÿæˆå’ŒéªŒè¯å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ data/              æ•°æ®å­˜å‚¨ç›®å½•
â”‚   â”‚   â””â”€â”€ ğŸ“„ db.json               JSONæ•°æ®åº“æ–‡ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ uploads/           æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”‚   â”‚   â””â”€â”€ (ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ node_modules/      ä¾èµ–åŒ…ç›®å½•ï¼ˆå·²å®‰è£…21ä¸ªåŒ…ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ package.json              ä¾èµ–å’Œè„šæœ¬é…ç½®
â”‚   â””â”€â”€ ğŸ“„ .env                      ç¯å¢ƒå˜é‡é…ç½®ï¼ˆéœ€è‡ªè¡Œåˆ›å»ºï¼‰
â”‚
â”œâ”€â”€ ğŸ“ docs/                  æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ ç³»ç»Ÿå®Œæ•´æ€§è¯„ä¼°æŠ¥å‘Š.md      åŠŸèƒ½å®Œæ•´åº¦è¯„ä¼°ï¼ˆ76%ï¼‰
â”‚   â””â”€â”€ ğŸ“„ é€šçŸ¥ç³»ç»Ÿä½¿ç”¨è¯´æ˜.md        é€šçŸ¥åŠŸèƒ½è¯¦ç»†æ–‡æ¡£
â”‚
â”œâ”€â”€ ğŸ“„ README.md              é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ ğŸ“„ .gitignore             Gitå¿½ç•¥æ–‡ä»¶é…ç½®
â””â”€â”€ ğŸ“„ start.bat              Windowså¿«é€Ÿå¯åŠ¨è„šæœ¬
```

## ğŸ“‹ æ–‡ä»¶è¯´æ˜

### å‰ç«¯æ ¸å¿ƒæ–‡ä»¶

#### installation_schedule.htmlï¼ˆä¸»ç³»ç»Ÿï¼Œ3200+è¡Œï¼‰
- **åŠŸèƒ½**: æ—¥å†ç®¡ç†ç³»ç»Ÿæ ¸å¿ƒç•Œé¢
- **åŒ…å«æ¨¡å—**:
  - æ—¥/å‘¨/æœˆä¸‰ç§è§†å›¾åˆ‡æ¢
  - å·¥å•æ‹–æ‹½åˆ›å»ºå’Œç§»åŠ¨
  - å‘˜å·¥ç®¡ç†ä¾§è¾¹æ 
  - æœåŠ¡ç±»å‹ç®¡ç†
  - åä½œé¢æ¿ï¼ˆåœ¨çº¿ç”¨æˆ·ã€æ´»åŠ¨æ—¥å¿—ï¼‰
  - 12è‰²å·¥å•æ ‡è®°ç³»ç»Ÿ
  - æ—¶é—´æ»šè½®é€‰æ‹©å™¨
  - ç­›é€‰å’Œç»Ÿè®¡åŠŸèƒ½
- **ä¾èµ–**: app-config.js
- **è®¿é—®**: `http://localhost:3000/frontend/installation_schedule.html`

#### login.html
- **åŠŸèƒ½**: ç”¨æˆ·ç™»å½•å’Œæ³¨å†Œ
- **ç‰¹æ€§**: JWT tokenè®¤è¯ã€å¾®ä¿¡ç™»å½•å…¥å£
- **è®¿é—®**: `http://localhost:3000/frontend/login.html`

#### notification-center.html
- **åŠŸèƒ½**: é€šçŸ¥ä¸­å¿ƒ
- **ç‰¹æ€§**: 
  - å®æ—¶é€šçŸ¥åˆ—è¡¨
  - æŒ‰ç±»å‹ç­›é€‰ï¼ˆæ¶ˆæ¯/æˆåŠŸ/è­¦å‘Š/é”™è¯¯ï¼‰
  - æ ‡è®°å·²è¯»/æœªè¯»
  - è·³è½¬åˆ°ç›¸å…³å·¥å•
  - æ¯30ç§’è‡ªåŠ¨åˆ·æ–°
- **è®¿é—®**: `http://localhost:3000/frontend/notification-center.html`

#### reports.html
- **åŠŸèƒ½**: æ•°æ®æŠ¥è¡¨å’Œç»Ÿè®¡
- **ç‰¹æ€§**:
  - Chart.jså›¾è¡¨å¯è§†åŒ–
  - ç»Ÿè®¡æ¦‚è§ˆå¡ç‰‡
  - æ—¶é—´è¶‹åŠ¿åˆ†æ
  - æœåŠ¡ç±»å‹åˆ†å¸ƒ
  - å‘˜å·¥ç»©æ•ˆæ’å
  - ä½ç½®çƒ­åŠ›å›¾
  - JSON/CSVæ•°æ®å¯¼å‡º
- **è®¿é—®**: `http://localhost:3000/frontend/reports.html`

#### ai_assistant_float.html
- **åŠŸèƒ½**: ChatGPTé£æ ¼çš„æ‚¬æµ®AIåŠ©æ‰‹
- **ç‰¹æ€§**:
  - å¯æ‹–æ‹½ã€å¯è°ƒæ•´å¤§å°
  - é¡¹ç›®ç®¡ç†ï¼ˆåˆ›å»º/é‡å‘½å/åˆ é™¤ï¼‰
  - å¯¹è¯ç»„ç»‡åˆ°é¡¹ç›®ä¸­
  - æ–‡ä»¶ä¸Šä¼ å’Œé¢„è§ˆ
  - æœ€å°åŒ–åˆ°åœ†å½¢å›¾æ ‡
- **é›†æˆ**: DeepSeek API

#### app-config.js
- **åŠŸèƒ½**: å‰ç«¯å…¨å±€é…ç½®
- **å†…å®¹**:
  ```javascript
  const API_BASE_URL = 'http://localhost:3000';
  const DEEPSEEK_API_URL = '...';
  const DEEPSEEK_API_KEY = '...';
  function fetchWithAuth(url, options) { ... }
  ```

### åç«¯æ ¸å¿ƒæ–‡ä»¶

#### index.jsï¼ˆä¸»å…¥å£ï¼‰
- **åŠŸèƒ½**: Expressåº”ç”¨å¯åŠ¨å’Œé…ç½®
- **åŒ…å«**:
  - 11ä¸ªè·¯ç”±æ¨¡å—æ³¨å†Œ
  - CORSè·¨åŸŸé…ç½®
  - é™æ€æ–‡ä»¶æœåŠ¡ï¼ˆ/frontend, /uploadsï¼‰
  - é”™è¯¯å¤„ç†ä¸­é—´ä»¶
  - é€šçŸ¥è°ƒåº¦å™¨å¯åŠ¨
- **ç«¯å£**: 3000ï¼ˆå¯åœ¨.envä¸­é…ç½®ï¼‰

#### scheduler.jsï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰
- **åŠŸèƒ½**: è‡ªåŠ¨é€šçŸ¥æé†’ç³»ç»Ÿ
- **ä»»åŠ¡**:
  1. å·¥å•æé†’ï¼ˆæ¯30åˆ†é’Ÿï¼‰
     - é€¾æœŸå·¥å•æé†’
     - å³å°†å¼€å§‹æé†’ï¼ˆ2å°æ—¶å†…ï¼‰
     - ä»Šæ—¥å·¥å•æé†’
  2. å·¥ä½œé‡é¢„è­¦ï¼ˆæ¯å¤©8ç‚¹ï¼‰
     - æ£€æµ‹å‘˜å·¥æ˜¯å¦è¶…è¿‡5ä¸ªæœªå®Œæˆå·¥å•
- **ä¾èµ–**: node-cron

#### db.jsï¼ˆæ•°æ®åº“æ“ä½œï¼‰
- **åŠŸèƒ½**: JSONæ–‡ä»¶è¯»å†™å°è£…
- **æ–¹æ³•**:
  - `initDb()`: åˆå§‹åŒ–æ•°æ®åº“
  - `readDb()`: è¯»å–æ•°æ®
  - `writeDb(data)`: å†™å…¥æ•°æ®
- **æ–‡ä»¶**: backend/data/db.json

### è·¯ç”±æ¨¡å—è¯¦è§£

#### authRoutes.jsï¼ˆè®¤è¯ï¼‰
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/auth/refresh` - åˆ·æ–°token

#### taskRoutes.jsï¼ˆå·¥å•ï¼‰
- `GET /api/tasks` - è·å–å·¥å•åˆ—è¡¨
- `POST /api/tasks` - åˆ›å»ºå·¥å•
- `PUT /api/tasks/:id` - æ›´æ–°å·¥å•
- `PUT /api/tasks/:id/move` - æ‹–æ‹½ç§»åŠ¨å·¥å•
- `DELETE /api/tasks/:id` - åˆ é™¤å·¥å•

#### staffRoutes.jsï¼ˆå‘˜å·¥ï¼‰
- `GET /api/staff` - è·å–å‘˜å·¥åˆ—è¡¨
- `POST /api/staff` - æ·»åŠ å‘˜å·¥
- `PUT /api/staff/:id` - æ›´æ–°å‘˜å·¥
- `DELETE /api/staff/:id` - åˆ é™¤å‘˜å·¥

#### notificationRoutes.jsï¼ˆé€šçŸ¥ï¼‰
- `GET /api/notifications` - è·å–é€šçŸ¥åˆ—è¡¨
- `POST /api/notifications` - åˆ›å»ºé€šçŸ¥
- `PUT /api/notifications/:id/read` - æ ‡è®°å·²è¯»
- `PUT /api/notifications/read-all` - å…¨éƒ¨æ ‡è®°å·²è¯»
- `DELETE /api/notifications/:id` - åˆ é™¤é€šçŸ¥
- `GET /api/notifications/unread-count` - æœªè¯»æ•°é‡
- `POST /api/notifications/task-reminder` - å·¥å•æé†’

#### reportRoutes.jsï¼ˆæŠ¥è¡¨ï¼‰
- `GET /api/reports/overview` - ç»Ÿè®¡æ¦‚è§ˆ
- `GET /api/reports/staff-performance` - å‘˜å·¥ç»©æ•ˆ
- `GET /api/reports/time-trend?groupBy=day|week|month` - æ—¶é—´è¶‹åŠ¿
- `GET /api/reports/service-analysis` - æœåŠ¡åˆ†æ
- `GET /api/reports/location-heatmap` - ä½ç½®çƒ­åŠ›å›¾
- `GET /api/reports/export/json?type=all|tasks|staff|services` - JSONå¯¼å‡º
- `GET /api/reports/export/csv?type=tasks|staff` - CSVå¯¼å‡º

#### aiRoutes.jsï¼ˆAIåŠ©æ‰‹ï¼‰
- `POST /api/ai/chat` - AIå¯¹è¯
- `POST /api/ai/upload` - æ–‡ä»¶ä¸Šä¼ åˆ†æ

#### å…¶ä»–è·¯ç”±
- **serviceRoutes.js**: æœåŠ¡ç±»å‹CRUD
- **activityRoutes.js**: æ´»åŠ¨æ—¥å¿—è®°å½•
- **fileRoutes.js**: æ–‡ä»¶ä¸Šä¼ ç®¡ç†
- **onlineRoutes.js**: åœ¨çº¿ç”¨æˆ·è¿½è¸ª
- **wechatRoutes.js**: å¾®ä¿¡OAuthé›†æˆ

## ğŸ”‘ é…ç½®æ–‡ä»¶

### backend/.envï¼ˆéœ€æ‰‹åŠ¨åˆ›å»ºï¼‰
```env
PORT=3000
JWT_SECRET=your-secret-key-change-this-in-production
DEEPSEEK_API_KEY=sk-your-deepseek-api-key
DB_PATH=./data/db.json
UPLOAD_DIR=./uploads
```

### backend/data/db.jsonï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
```json
{
  "users": [],
  "tasks": [],
  "staff": [],
  "services": [],
  "activity": [],
  "notifications": [],
  "onlineUsers": []
}
```

## ğŸš€ å¯åŠ¨æµç¨‹

### æ–¹å¼1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
```cmd
åŒå‡» start.bat
```

### æ–¹å¼2ï¼šæ‰‹åŠ¨å¯åŠ¨
```bash
cd backend
npm install  # é¦–æ¬¡è¿è¡Œéœ€è¦å®‰è£…ä¾èµ–
npm start
```

### è®¿é—®åœ°å€
- **ä¸»é¡µ**: http://localhost:3000/
- **ç™»å½•**: http://localhost:3000/frontend/login.html
- **æ—¥å†**: http://localhost:3000/frontend/installation_schedule.html
- **é€šçŸ¥**: http://localhost:3000/frontend/notification-center.html
- **æŠ¥è¡¨**: http://localhost:3000/frontend/reports.html
- **å¥åº·æ£€æŸ¥**: http://localhost:3000/api/health

## ğŸ“¦ ä¾èµ–åŒ…

### æ ¸å¿ƒä¾èµ–ï¼ˆ11ä¸ªï¼‰
1. **express** ^5.1.0 - Webæ¡†æ¶
2. **cors** ^2.8.5 - è·¨åŸŸæ”¯æŒ
3. **jsonwebtoken** ^9.0.2 - JWTè®¤è¯
4. **bcryptjs** ^3.0.3 - å¯†ç åŠ å¯†
5. **multer** ^2.0.2 - æ–‡ä»¶ä¸Šä¼ 
6. **axios** ^1.13.2 - HTTPå®¢æˆ·ç«¯
7. **dayjs** ^1.11.19 - æ—¥æœŸå¤„ç†
8. **uuid** ^13.0.0 - UUIDç”Ÿæˆ
9. **dotenv** ^17.2.3 - ç¯å¢ƒå˜é‡
10. **node-cron** - å®šæ—¶ä»»åŠ¡ï¼ˆæœ€æ–°æ·»åŠ ï¼‰

### å‰ç«¯ä¾èµ–ï¼ˆCDNï¼‰
- **Chart.js** 4.4.0 - å›¾è¡¨åº“

## ğŸ“Š æ•°æ®æµå‘

```
ç”¨æˆ·æ“ä½œ â†’ å‰ç«¯é¡µé¢ â†’ app-config.js(fetchWithAuth) 
    â†“
JWT TokenéªŒè¯ â†’ åç«¯è·¯ç”± â†’ ä¸šåŠ¡é€»è¾‘ 
    â†“
db.jsæ“ä½œ â†’ db.jsonè¯»å†™ â†’ è¿”å›æ•°æ®
    â†“
å‰ç«¯æ¸²æŸ“ â†’ ç”¨æˆ·ç•Œé¢æ›´æ–°
```

## ğŸ”’ å®‰å…¨æœºåˆ¶

1. **JWTè®¤è¯**: æ‰€æœ‰APIè¯·æ±‚éœ€è¦Bearer Token
2. **å¯†ç åŠ å¯†**: bcryptjsåŠ ç›å“ˆå¸Œå­˜å‚¨
3. **CORSé…ç½®**: ä»…å…è®¸é…ç½®çš„æºè®¿é—®
4. **æ–‡ä»¶ä¸Šä¼ **: å¤§å°é™åˆ¶5MB
5. **è¾“å…¥éªŒè¯**: è·¯ç”±å±‚å‚æ•°æ ¡éªŒ

## ğŸ› ï¸ å¼€å‘å»ºè®®

### æ·»åŠ æ–°åŠŸèƒ½
1. åœ¨ `backend/src/routes/` åˆ›å»ºæ–°è·¯ç”±æ–‡ä»¶
2. åœ¨ `backend/src/index.js` æ³¨å†Œè·¯ç”±
3. åœ¨ `frontend/` åˆ›å»ºå¯¹åº”é¡µé¢
4. æ›´æ–° `db.json` ç»“æ„ï¼ˆå¦‚éœ€ï¼‰

### è°ƒè¯•æŠ€å·§
- åç«¯æ—¥å¿—ï¼šæŸ¥çœ‹ç»ˆç«¯è¾“å‡º
- å‰ç«¯æ—¥å¿—ï¼šæµè§ˆå™¨DevToolsæ§åˆ¶å°
- æ•°æ®æ£€æŸ¥ï¼šç›´æ¥æŸ¥çœ‹ `db.json` æ–‡ä»¶
- APIæµ‹è¯•ï¼šä½¿ç”¨Postmanæˆ–curl

### å¸¸ç”¨å‘½ä»¤
```bash
# æŸ¥çœ‹ä¾èµ–
cd backend && npm list --depth=0

# æ¸…é™¤ç¼“å­˜é‡è£…
rm -rf node_modules package-lock.json
npm install

# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -ano | findstr :3000

# åœæ­¢æœåŠ¡
Ctrl + C
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ•°æ®åº“å‡çº§**: JSON â†’ MongoDB/PostgreSQL
2. **å®æ—¶é€šä¿¡**: HTTPè½®è¯¢ â†’ WebSocket
3. **å‰ç«¯ä¼˜åŒ–**: å¼•å…¥Vue/Reactæ¡†æ¶
4. **ç¼“å­˜æœºåˆ¶**: Redisç¼“å­˜çƒ­ç‚¹æ•°æ®
5. **CDNåŠ é€Ÿ**: é™æ€èµ„æºä½¿ç”¨CDN
6. **ä»£ç åˆ†å‰²**: æŒ‰éœ€åŠ è½½æ¨¡å—

## ğŸ”„ ç‰ˆæœ¬å†å²

- **v1.0** (å½“å‰): åŸºç¡€åŠŸèƒ½å®Œæ•´ï¼Œç³»ç»Ÿå®Œæ•´åº¦76%
- **v1.1** (è®¡åˆ’): æƒé™ç³»ç»Ÿã€æ•°æ®å¤‡ä»½
- **v2.0** (è®¡åˆ’): æ•°æ®åº“è¿ç§»ã€WebSocketã€å®¢æˆ·ç®¡ç†

---

**æœ€åæ›´æ–°**: 2024å¹´1æœˆ  
**ç»´æŠ¤è€…**: GitHub Copilot
